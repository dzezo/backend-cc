const Sequelize = require('sequelize')
const { DataType, Op } = Sequelize

const sequelize = new Sequelize(
    'db_name', 
    'db_username', 
    'db_password',
    {
        host: 'localhost'
        port: 3306
        dialect: 'mysql'
    }
);

sequelize.authenticate().then(() => {
    console.log('Connection OK!');
}).catch((err) => {
    console.log('Connection failed');
})

const Student = sequelize.define('student', {
    student_id: {
        type: DataType.INTEGER,
        autoIncrement: true,
        primaryKey: true,
    },
    name: {
        type: DataType.STRING,
        allowNull: false,
        validate: {
            len: [4, 20],
        }
    },
    favorite_class: {
        type: DataType.STRING(25)
        defaultValue: "Computer Science"
    },
    school_year: {
        type: DataType.INTEGER,
        allowNull: false,
    },
    subscribed_to_wittcode {
        type: DataType.BOOLEAN,
        defaultValue: true
    }
});

Student
.sync({ alter: true })
.then(() => {
    return Student.bulkCreate([
        ...
    ], {
        validate: true
    })
})
.then(() => {
    console.log('Insertion OK!');

    return Student.findAll({
        attributes: ['name'],
        where: {
            [Op.or]: { favorite_class: "Computer Science", subscribed_to_wittCode, true }
        }
    })
})
.then((data) => {
    console.log('Query A OK')

    return Student.findAll({
        attributes: [
            'school_year'
            [sequelize.fn('COUNT', sequelize.col('school_year')), 'num_students']
        ],
        group: 'school_year'
    })  
})
.then((data) => {
    console.log('Query B OK')
})
.catch((err) => {
    console.error(err);
})
